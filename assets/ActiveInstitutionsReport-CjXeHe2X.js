const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./exceljs.min-B8t_jxSM.js","./index-ZXlslG1z.js","./index-BZxwZwPS.css","./_commonjs-dynamic-modules-TDtrdbi3.js"])))=>i.map(i=>d[i]);
import{r as g,O as S,p as B,h as _,F,n as N,an as D,ap as R,a6 as A,ab as y,bv as C,j as e,aP as L,N as U,a5 as P,b0 as Y,J as T}from"./index-ZXlslG1z.js";const M=l=>l?l.split(/\s*[-–—]\s*/)[0].trim():"Sin Nombre",Z=async l=>{if(l)return{instituciones:[],lanzamientos:[]};const[p,u]=await Promise.all([T.instituciones.getAll({fields:[A,C,y]}),T.lanzamientos.getAll({fields:[F,_,R,D]})]);return{instituciones:p,lanzamientos:u}},G=({isTestingMode:l=!1})=>{const[p,u]=g.useState(null),[v,E]=g.useState(!1),{data:h,isLoading:O,error:I}=S({queryKey:["activeInstitutionsReportData",l],queryFn:()=>Z(l)}),f=g.useMemo(()=>{if(!h)return[];const o=new Date().getFullYear(),m=h.lanzamientos.filter(s=>{const n=B(s[_]);return n&&n.getUTCFullYear()===o}),i=["relevamiento del ejercicio profesional","jornada universitaria de salud mental"],b=m.filter(s=>{const n=s[F];if(!n)return!0;const r=N(n);return!i.some(a=>r.includes(a))}),c=new Map;return b.forEach(s=>{const n=s[F];if(!n)return;const r=M(n);c.has(r)||c.set(r,{institucion:r,anioConvenio:"",orientaciones:"",tutor:"No disponible",lanzamientosCount:0,cuposTotal:0});const a=c.get(r);a.lanzamientosCount++,a.cuposTotal+=s[D]||0;const t=s[R];t&&!a.orientaciones.includes(t)&&(a.orientaciones=a.orientaciones?`${a.orientaciones}, ${t}`:t)}),c.forEach(s=>{const n=N(s.institucion);let r,a="";for(const t of h.instituciones){const x=t[A];x&&N(x).startsWith(n)&&(!r&&t[y]&&(r=t[y]),t[C]&&(a=t[C]))}s.tutor=r||"No disponible",s.anioConvenio=a||"-"}),Array.from(c.values()).sort((s,n)=>s.institucion.localeCompare(n.institucion))},[h]),z=async()=>{if(f.length===0){u({message:"No hay datos para exportar.",type:"error"});return}E(!0);try{const o=(await Y(async()=>{const{default:t}=await import("./exceljs.min-B8t_jxSM.js").then(x=>x.e);return{default:t}},__vite__mapDeps([0,1,2,3]),import.meta.url)).default,m=new o.Workbook,i=m.addWorksheet("Instituciones Activas"),b=i.addRow([`Reporte de Instituciones Activas ${new Date().getFullYear()}`]);i.mergeCells("A1:F1"),b.font={name:"Calibri",size:24,bold:!0,color:{argb:"FF1E40AF"}},b.alignment={vertical:"middle",horizontal:"center"},i.getRow(1).height=50,i.addRow([]);const c=["Institución","Año del Convenio","Orientación(es)","Tutor Institucional","Nº de Lanzamientos (año)","Cupos Totales (año)"],s=i.addRow(c);s.height=45,s.eachCell(t=>{t.font={name:"Calibri",bold:!0,color:{argb:"FFFFFFFF"},size:14},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2563EB"}},t.border={top:{style:"thin",color:{argb:"FFBFDBFE"}},left:{style:"thin",color:{argb:"FFBFDBFE"}},bottom:{style:"thin",color:{argb:"FFBFDBFE"}},right:{style:"thin",color:{argb:"FFBFDBFE"}}},t.alignment={vertical:"middle",horizontal:"center",wrapText:!0}}),f.forEach((t,x)=>{const j=i.addRow([t.institucion,t.anioConvenio,t.orientaciones,t.tutor,t.lanzamientosCount,t.cuposTotal]);j.height=35,j.eachCell({includeEmpty:!0},(d,w)=>{if(d.font={name:"Calibri",size:13},d.border={top:{style:"thin",color:{argb:"FFCBD5E1"}},left:{style:"thin",color:{argb:"FFCBD5E1"}},bottom:{style:"thin",color:{argb:"FFCBD5E1"}},right:{style:"thin",color:{argb:"FFCBD5E1"}}},d.alignment={vertical:"middle",wrapText:!0,indent:1},x%2!==0&&(d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8FAFC"}}),w===2&&t.anioConvenio){const k=Number(t.anioConvenio);!isNaN(k)&&k>=2024&&(d.font={name:"Calibri",size:13,bold:!0,color:{argb:"FF15803D"}},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFDCFCE7"}})}[2,5,6].includes(w)&&(d.alignment.horizontal="center")})}),i.columns=[{key:"institucion",width:60},{key:"anioConvenio",width:25},{key:"orientaciones",width:40},{key:"tutor",width:35},{key:"lanzamientos",width:22},{key:"cupos",width:22}];const n=await m.xlsx.writeBuffer(),r=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=document.createElement("a");a.href=URL.createObjectURL(r),a.download=`Reporte Instituciones Activas ${new Date().getFullYear()}.xlsx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),u({message:"Reporte descargado exitosamente.",type:"success"})}catch(o){console.error("Failed to generate Excel file:",o),u({message:"Ocurrió un error al generar el archivo Excel.",type:"error"})}finally{E(!1)}};return O?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(L,{})}):I?e.jsx(U,{icon:"error",title:"Error",message:I.message}):e.jsxs("div",{className:"space-y-6",children:[p&&e.jsx(P,{message:p.message,type:p.type,onClose:()=>u(null)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Reporte de Instituciones Activas"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Instituciones con actividad durante ",new Date().getFullYear(),"."]})]}),e.jsxs("button",{onClick:z,disabled:v,className:"inline-flex items-center gap-2 bg-emerald-600 text-white font-bold text-sm py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors shadow-md hover:shadow-lg hover:-translate-y-0.5 active:scale-95 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[v?e.jsx("div",{className:"w-4 h-4 border-2 border-white/50 border-t-white rounded-full animate-spin"}):e.jsx("span",{className:"material-icons !text-base",children:"download"}),"Descargar Excel"]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 text-xs text-slate-500 dark:text-slate-400 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 font-bold",children:"Institución"}),e.jsx("th",{className:"px-6 py-3 font-bold text-center",children:"Año Convenio"}),e.jsx("th",{className:"px-6 py-3 font-bold",children:"Orientación(es)"}),e.jsx("th",{className:"px-6 py-3 font-bold",children:"Tutor"}),e.jsx("th",{className:"px-6 py-3 font-bold text-center",children:"Lanzamientos"}),e.jsx("th",{className:"px-6 py-3 font-bold text-center",children:"Cupos"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:[f.map((o,m)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-3 font-medium text-slate-900 dark:text-white",children:o.institucion}),e.jsx("td",{className:"px-6 py-3 text-center",children:o.anioConvenio?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",children:o.anioConvenio}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx("td",{className:"px-6 py-3 text-slate-600 dark:text-slate-300",children:o.orientaciones}),e.jsx("td",{className:"px-6 py-3 text-slate-600 dark:text-slate-300",children:o.tutor}),e.jsx("td",{className:"px-6 py-3 text-center font-bold text-slate-700 dark:text-slate-300",children:o.lanzamientosCount}),e.jsx("td",{className:"px-6 py-3 text-center font-bold text-slate-700 dark:text-slate-300",children:o.cuposTotal})]},m)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500 dark:text-slate-400",children:"No se encontraron datos para mostrar."})})]})]})})})]})};export{G as default};
