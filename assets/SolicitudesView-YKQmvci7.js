import{c as U,e as b,b as g,f,g as M,r as o,F as w,h as R,p as j,n as k,i as v,j as a,P as y,k as z,l as q,m as B,o as G,q as J,s as H,t as Y,v as Z,w as K,x as Q,y as V,z as W,B as $,D as X,E as ee,G as se,H as ae,I as te,J as ie,K as oe,L as ne}from"./index-ZXlslG1z.js";import{S as re,P as le,F as ce}from"./PreSolicitudCheckModal-J-N_Aj9Q.js";const ue=()=>{const{solicitudes:C,studentDetails:s,criterios:p,allLanzamientos:u,finalizacionRequest:F}=U(),{openSolicitudPPSModal:E}=b(),{authenticatedUser:r}=g(),{showToast:_}=f(),m=M(),[N,l]=o.useState(!1),[D,c]=o.useState(!1),S=()=>s&&s.id?s.id:(r==null?void 0:r.id)||null,A=o.useMemo(()=>{const e=new Set,n=new Date().getFullYear(),d=["relevamiento del ejercicio profesional","jornada universitaria de salud mental"];return u.forEach(t=>{const i=t[w],T=t[R];if(i&&T){const O=j(T);if(O&&O.getUTCFullYear()===n){const x=k(i);if(!d.some(I=>x.includes(I))){const I=i.split(" - ")[0].trim();e.add(I)}}}}),Array.from(e).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).sort((t,i)=>t.localeCompare(i))},[u]),L=v({mutationFn:async e=>{const n=S();if(!n)throw new Error("Error identificando al estudiante.");const d={[ne]:n,[ae]:s==null?void 0:s[te],[ee]:s==null?void 0:s[se],[$]:s==null?void 0:s[X],[W]:e.nombreInstitucion,[V]:e.localidad,[Q]:e.direccion,[K]:e.emailInstitucion,[Z]:e.telefonoInstitucion,[Y]:e.referente,[H]:e.tieneConvenio,[J]:e.tieneTutor,[G]:e.contactoTutor,[B]:e.tipoPractica,[q]:e.descripcion,[oe]:"Pendiente",[z]:new Date().toISOString().split("T")[0]};await ie.solicitudes.create(d)},onSuccess:()=>{_("Tu solicitud de PPS ha sido registrada. Te notificaremos cuando haya novedades.","success"),m.invalidateQueries({queryKey:["solicitudes"]})},onError:e=>{_(`Hubo un problema al enviar la solicitud: ${e.message}`,"error")}}),h=o.useCallback(()=>{c(!0)},[]),P=o.useCallback(()=>{c(!1),E(async e=>{await L.mutateAsync(e)})},[E,L]);return a.jsxs(a.Fragment,{children:[a.jsx(y,{icon:"list_alt",title:a.jsxs("span",{children:["Mis"," ",a.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400",children:"Solicitudes"})]}),description:"Seguimiento del estado de las PPS que has solicitado.",children:a.jsx(re,{solicitudes:C,onCreateSolicitud:h,onRequestFinalization:()=>l(!0),criterios:p,finalizacionRequest:F})}),a.jsx(le,{isOpen:D,onClose:()=>c(!1),onContinue:P,existingInstitutions:A}),N&&a.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",children:a.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-800 rounded-2xl shadow-2xl",children:[a.jsx("button",{onClick:()=>l(!1),className:"absolute top-4 right-4 z-10 p-2 bg-white/80 dark:bg-slate-700/80 rounded-full hover:bg-slate-100 dark:hover:bg-slate-600 text-slate-50 dark:text-slate-300 transition-colors shadow-sm backdrop-blur-sm",children:a.jsx("span",{className:"material-icons",children:"close"})}),a.jsx(ce,{studentAirtableId:S(),onClose:()=>l(!1)})]})})]})};export{ue as default};
