import{aJ as lt,aH as nt,b$ as rt,c0 as ot,c1 as it,bz as pe,b8 as ze,b5 as Ke,a_ as $e,D as Ge,b9 as dt,a$ as Qe,ba as Je,c2 as ct,aX as We,aW as Xe,G as Y,I as ue,at as ut,b6 as be,bi as Ye,bh as Ne,be as Ce,bf as et,bg as Ae,aE as he,bd as J,aC as W,c3 as bt,l as xt,m as mt,o as pt,q as gt,s as It,t as Nt,v as ht,w as Et,x as ft,y as St,c4 as _t,B as Ct,E as At,H as Ot,L as kt,c5 as yt,k as Tt,K as jt,z as Lt,aw as vt,bc as Dt,c6 as Ft,b2 as wt,V as Rt,_ as Pt,c7 as Mt,c8 as Ut,c9 as Vt,a1 as Ht,an as qt,ao as Bt,ap as Zt,ad as zt,ak as Kt,Z as $t,h as de,F as re,aK as Gt,aI as Qt,aG as Jt,bk as Wt,bs as Xt,bt as Yt,bl as ea,bm as ta,bn as aa,bo as sa,bp as la,aL as na,aM as ra,aN as oa,aO as ia,aV as da,ax as Oe,bq as ca,br as ua,az as ke,aU as ba,aR as xa,aS as ma,aB as ge,aT as Me,a3 as Ie,bu as xe,av as pa,ab as Ue,bv as le,a7 as ye,ac as tt,a6 as z,ca as ga,aF as Ia,cb as Na,cc as ha,cd as Ea,aD as fa,bF as Sa,bE as _a,bD as Ca,bC as Aa,Y as Oa,a0 as ka,by as ya,ce as Ta,cf as ja,cg as La,ch as va,ci as Da,cj as Fa,j as e,r as n,bI as wa,g as Te,O as ce,N as qe,i as K,J as g,a5 as je,as as Ee,aP as Le,bb as Ra,ck as ne,M as Pe,aQ as at,bJ as Pa,bj as Ma,bx as fe,a2 as Ua,bw as Va,n as Se,cl as Ha,C as qa}from"./index-ZXlslG1z.js";import{S as Ba}from"./SubTabs-B9w5BDf5.js";import{R as ve,s as De}from"./dbSchema-B3bE2DnB.js";import{o as ae,s as t,b as me,e as Za,n as $,c as O,a as _e}from"./types-CzNk-woI.js";import{C as Fe}from"./ConfirmModal-DfSwa4qW.js";import{A as za}from"./types-Cg8ilULs.js";import{A as Ve}from"./AdminSearch-DMlT1HSE.js";import"./UnifiedTabs-xSvmzb6C.js";import"./proxy-BFxRqQFC.js";const He=["Activo","Finalizado","Inactivo","Nuevo (Sin cuenta)"],oe=ae({id:t(),createdTime:t().optional(),created_at:t().optional()}),Ka=ae({[ue]:t().or($()).optional().nullable(),[Y]:t().optional().nullable(),[Xe]:t().optional().nullable(),[We]:t().optional().nullable(),[ct]:t().optional().nullable(),[Je]:t().optional().nullable(),[Qe]:$().optional().nullable(),[dt]:t().optional().nullable(),[Ge]:t().optional().nullable(),[$e]:t().optional().nullable(),[Ke]:t().optional().nullable(),[ze]:t().optional().nullable(),[pe]:Za(He).optional().nullable(),[it]:t().uuid().optional().nullable(),[ot]:me().optional().nullable(),[rt]:t().optional().nullable(),[nt]:me().optional().nullable(),[lt]:t().optional().nullable()}),$a=ae({[bt]:O(t().or($())).optional().nullable(),[W]:t().or(O(t())).optional().nullable(),[J]:t().or(O(t())).optional().nullable(),[he]:$().optional().nullable(),[Ae]:t().optional().nullable(),[et]:t().optional().nullable(),[Ce]:t().optional().nullable(),[Ne]:t().optional().nullable(),[Ye]:t().optional().nullable(),[be]:t().or(O(t())).optional().nullable(),[ut]:t().or(O(t())).optional().nullable()}),Ga=ae({[Lt]:t().or(O(t())).optional().nullable(),[jt]:t().optional().nullable(),[Tt]:t().optional().nullable(),[yt]:t().optional().nullable(),[kt]:t().or(O(t())).optional().nullable(),[Ot]:t().or($()).optional().nullable(),[At]:t().optional().nullable(),[Ct]:t().optional().nullable(),[_t]:t().optional().nullable(),[St]:t().optional().nullable(),[ft]:t().optional().nullable(),[Et]:t().optional().nullable(),[ht]:t().optional().nullable(),[Nt]:t().optional().nullable(),[It]:t().optional().nullable(),[gt]:t().optional().nullable(),[pt]:t().optional().nullable(),[mt]:t().optional().nullable(),[xt]:t().optional().nullable()}),Qa=ae({[re]:t().optional().nullable(),[de]:t().optional().nullable(),[$t]:t().optional().nullable(),[Kt]:t().optional().nullable(),[zt]:t().optional().nullable(),[Zt]:t().optional().nullable(),[Bt]:$().optional().nullable(),[qt]:$().optional().nullable(),[Ht]:t().optional().nullable(),[Vt]:$().optional().nullable(),[Ut]:t().optional().nullable(),[Mt]:t().optional().nullable(),[Pt]:t().optional().nullable(),[Rt]:t().optional().nullable(),[wt]:t().optional().nullable(),[Ft]:t().optional().nullable(),[Dt]:me().optional().nullable(),[vt]:t().optional().nullable()}),Ja=ae({[Ie]:t().or(O(t())).optional().nullable(),[Me]:t().or(O(t())).optional().nullable(),[ge]:t().or(O(t())).optional().nullable(),[ma]:t().optional().nullable(),[xa]:t().optional().nullable(),[ba]:t().optional().nullable(),[ke]:t().optional().nullable(),[ua]:$().optional().nullable(),[ca]:$().optional().nullable(),[Oe]:t().optional().nullable(),[da]:t().optional().nullable(),[ia]:t().optional().nullable(),[oa]:t().optional().nullable(),[ra]:t().optional().nullable(),[na]:t().optional().nullable(),[la]:t().or($()).optional().nullable(),[sa]:$().optional().nullable(),[aa]:t().optional().nullable(),[ta]:t().optional().nullable(),[ea]:t().optional().nullable(),[Yt]:me().optional().nullable(),[Xt]:t().optional().nullable(),[Wt]:_e().optional().nullable(),[Jt]:me().optional().nullable(),[Qt]:t().optional().nullable(),[Gt]:t().optional().nullable()}),Wa=ae({[z]:t().optional().nullable(),[tt]:t().optional().nullable(),[ye]:t().optional().nullable(),[le]:t().or(me()).optional().nullable(),[Ue]:t().optional().nullable(),[pa]:t().optional().nullable(),[xe]:t().optional().nullable()}),Xa=ae({[fa]:t().or(O(t())).optional().nullable(),[Ea]:t().optional().nullable(),[ha]:t().optional().nullable(),[Na]:t().optional().nullable(),[Ia]:$().optional().nullable(),[ga]:t().or(O(t())).optional().nullable()}),Ya=ae({[ya]:t().or(O(t())).optional().nullable(),[ka]:t().optional().nullable(),[Oa]:t().optional().nullable(),[Aa]:_e().optional().nullable(),[Ca]:_e().optional().nullable(),[_a]:_e().optional().nullable(),[Sa]:t().optional().nullable()}),es=ae({[Fa]:t().optional().nullable(),[Da]:t().optional().nullable(),[va]:t().optional().nullable(),[La]:t().optional().nullable(),[ja]:t().optional().nullable(),[Ta]:O(t()).optional().nullable()});O(oe.merge(Ka));O(oe.merge($a));O(oe.merge(Ga));O(oe.merge(Qa));O(oe.merge(Ja));O(oe.merge(Wa));O(oe.merge(Xa));O(oe.merge(Ya));O(oe.merge(es));const ts=[10,25,50,100],we=({currentPage:I,totalPages:o,onPageChange:N,itemsPerPage:y,onItemsPerPageChange:T,totalItems:u,className:V=""})=>e.jsxs("div",{className:`flex flex-col sm:flex-row justify-between items-center gap-4 py-4 px-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50 ${V}`,children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Mostrar"}),e.jsx("select",{value:y,onChange:d=>{T(Number(d.target.value)),N(1)},className:"bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg px-2 py-1 focus:ring-2 focus:ring-blue-500 outline-none text-slate-700 dark:text-slate-200",children:ts.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("span",{className:"hidden sm:inline-block border-l border-slate-300 dark:border-slate-600 pl-4 h-4 leading-4",children:["Total: ",u]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(I-1),disabled:I===1,className:"p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-30 disabled:hover:bg-transparent transition-colors text-slate-600 dark:text-slate-300",children:e.jsx("span",{className:"material-icons !text-lg",children:"chevron_left"})}),e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-200 min-w-[3rem] text-center",children:[I," / ",o||1]}),e.jsx("button",{onClick:()=>N(I+1),disabled:I===o||o===0,className:"p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-30 disabled:hover:bg-transparent transition-colors text-slate-600 dark:text-slate-300",children:e.jsx("span",{className:"material-icons !text-lg",children:"chevron_right"})})]})]}),Re=({x:I,y:o,onClose:N,options:y})=>{const T=n.useRef(null);n.useEffect(()=>{const x=L=>{T.current&&!T.current.contains(L.target)&&N()};return document.addEventListener("mousedown",x,!0),window.addEventListener("resize",N),window.addEventListener("scroll",N,!0),()=>{document.removeEventListener("mousedown",x,!0),window.removeEventListener("resize",N),window.removeEventListener("scroll",N,!0)}},[N]);const u=220,V=y.length*45+20;let d=I,E=o;return I+u>window.innerWidth&&(d=I-u),o+V>window.innerHeight&&(E=o-V),d=Math.max(10,d),E=Math.max(10,E),wa.createPortal(e.jsx("div",{ref:T,className:"fixed z-[9999] bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border border-slate-200 dark:border-slate-700 rounded-2xl shadow-2xl py-2 min-w-[210px] animate-scale-in",style:{top:E,left:d},onContextMenu:x=>x.preventDefault(),children:y.map((x,L)=>e.jsxs("button",{onClick:C=>{C.stopPropagation(),x.onClick(),N()},className:`
                        w-full flex items-center gap-3 px-4 py-2.5 text-xs font-black uppercase tracking-tight transition-all
                        ${x.variant==="danger"?"text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20":"text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400"}
                    `,children:[e.jsx("span",{className:"material-icons !text-lg",children:x.icon}),x.label]},L))}),document.body)},as={label:"Estudiantes",tableName:Ra,schema:De.estudiantes,searchFields:[Y,ue],fieldConfig:[{key:ue,label:"Legajo",type:"text"},{key:Xe,label:"Nombre",type:"text"},{key:We,label:"Apellido",type:"text"},{key:Qe,label:"DNI",type:"number"},{key:Ge,label:"Correo",type:"email"},{key:$e,label:"Teléfono",type:"tel"},{key:Je,label:"Orientación",type:"select",options:["","Clinica","Educacional","Laboral","Comunitaria"]},{key:pe,label:"Estado",type:"select",options:He},{key:ze,label:"Fecha Fin",type:"date"},{key:Ke,label:"Notas",type:"textarea"}]},ss=({isTestingMode:I})=>{const[o,N]=n.useState(""),[y,T]=n.useState(""),[u,V]=n.useState(""),[d,E]=n.useState(1),[x,L]=n.useState(10),[C,f]=n.useState(null),[h,v]=n.useState(null),[j,H]=n.useState(null),[R,_]=n.useState(null),[b,p]=n.useState(null),Z=Te();n.useEffect(()=>{const l=setTimeout(()=>{T(o),E(1)},400);return()=>clearTimeout(l)},[o]);const{data:S,isLoading:P,error:G}=ce({queryKey:["editor-students",d,x,y,u,I],queryFn:async()=>{var s;const l={};u&&(l[pe]=u);const{records:a,total:c,error:A}=await g.estudiantes.getPage(d,x,{searchTerm:y,searchFields:[Y,ue],filters:l});if(A)throw new Error(((s=A.error)==null?void 0:s.message)||"Error al cargar estudiantes");const U=a.map(i=>i.id);if(U.length===0)return{records:[],total:0};const M=await g.practicas.getAll({filters:{[W]:U},fields:[W,he]});return{records:a.map(i=>{const m=M.filter(k=>{const w=k[W];return Array.isArray(w)?w.includes(i.id):String(w)===i.id});return{...i,__totalHours:m.reduce((k,w)=>k+(Number(w[he])||0),0)}}),total:c}}});if(G)return e.jsx(qe,{icon:"error",title:"Error de Carga",message:G.message});const Q=K({mutationFn:l=>g.estudiantes.update(l.id,l.fields),onSuccess:()=>{Z.invalidateQueries({queryKey:["editor-students"]}),_({message:"Estudiante actualizado",type:"success"}),v(null)}}),X=K({mutationFn:l=>g.estudiantes.create(l),onSuccess:()=>{Z.invalidateQueries({queryKey:["editor-students"]}),_({message:"Estudiante creado",type:"success"}),v(null)}}),ie=K({mutationFn:l=>g.estudiantes.delete(l),onSuccess:()=>{Z.invalidateQueries({queryKey:["editor-students"]}),_({message:"Estudiante eliminado",type:"success"}),p(null),f(null)},onError:l=>{_({message:`Error al eliminar: ${l.message}`,type:"error"}),p(null)}}),q=l=>{f(a=>a===l?null:l)},r=(l,a)=>{l.preventDefault(),f(a.id),H({x:l.clientX,y:l.clientY,record:a})},D=l=>{switch(l){case"Activo":return"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800";case"Finalizado":return"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800";case"Inactivo":return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700";case"Nuevo (Sin cuenta)":return"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800";default:return"bg-slate-50 text-slate-500 border-slate-200"}};return e.jsxs("div",{className:"space-y-6",children:[R&&e.jsx(je,{message:R.message,type:R.type,onClose:()=>_(null)}),e.jsx(Fe,{isOpen:!!b,title:"¿Eliminar Estudiante?",message:"Esta acción eliminará permanentemente al estudiante y sus registros. ¿Confirmar?",confirmText:"Eliminar",type:"danger",onConfirm:()=>b&&ie.mutate(b),onClose:()=>p(null)}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-col md:flex-row gap-4 items-end shadow-sm",children:[e.jsxs("div",{className:"flex-1 w-full space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Buscador Inteligente"}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"search",placeholder:"Nombre o legajo...",value:o,onChange:l=>N(l.target.value),className:"w-full h-11 pl-10 pr-4 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all placeholder:text-slate-400 dark:text-slate-200"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 material-icons text-slate-400 group-focus-within:text-blue-500 transition-colors",children:"search"})]})]}),e.jsxs("div",{className:"w-full md:w-56 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Filtrar Estado"}),e.jsxs("select",{value:u,onChange:l=>V(l.target.value),className:"w-full h-11 px-4 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"",children:"Todos"}),He.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsx(Ee,{onClick:()=>v({isCreating:!0}),icon:"person_add",className:"h-11 shadow-md bg-blue-600 hover:bg-blue-700 w-full sm:w-auto px-6",children:"Nuevo"})})]}),e.jsx("div",{className:"flex justify-end h-10",children:C&&e.jsx("div",{className:"flex gap-2 animate-fade-in",children:e.jsxs("button",{onClick:()=>p(C),className:"flex items-center gap-2 px-4 py-2 bg-rose-50 text-rose-600 rounded-lg text-xs font-black uppercase tracking-wider hover:bg-rose-100 border border-rose-200 transition-all",children:[e.jsx("span",{className:"material-icons !text-base",children:"delete"})," Eliminar Selección"]})})}),P?e.jsx("div",{className:"py-12",children:e.jsx(Le,{})}):e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl overflow-hidden bg-white dark:bg-[#020617] shadow-xl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-800 text-slate-500 dark:text-slate-400 uppercase text-[10px] font-black tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Estudiante"}),e.jsx("th",{className:"px-6 py-4",children:"Legajo"}),e.jsx("th",{className:"px-6 py-4",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Horas"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:S==null?void 0:S.records.map(l=>{const a=C===l.id;return e.jsxs("tr",{onClick:()=>q(l.id),onDoubleClick:()=>v(l),onContextMenu:c=>r(c,l),className:`transition-all cursor-pointer group ${a?"bg-blue-50 dark:bg-blue-900/20 ring-1 ring-inset ring-blue-200 dark:ring-blue-800":"hover:bg-slate-50/80 dark:hover:bg-slate-900/40"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-black shadow-sm border transition-transform group-hover:scale-110 ${a?"bg-blue-600 text-white border-blue-400":"bg-white dark:bg-slate-800 text-slate-400 border-slate-200 dark:border-slate-700"}`,children:(l[Y]||"?").charAt(0).toUpperCase()}),e.jsx("span",{className:`font-bold transition-colors ${a?"text-blue-700 dark:text-blue-300":"text-slate-700 dark:text-slate-200 group-hover:text-blue-600"}`,children:l[Y]})]})}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs text-slate-500 dark:text-slate-400",children:l[ue]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-black border uppercase tracking-wide ${D(l[pe])}`,children:l[pe]||"N/A"})}),e.jsxs("td",{className:"px-6 py-4 text-center",children:[e.jsx("span",{className:`text-sm font-black ${a?"text-blue-600 dark:text-blue-400":"text-slate-700 dark:text-slate-300"}`,children:Math.round(l.__totalHours||0)}),e.jsx("span",{className:"text-[10px] text-slate-400 ml-1 font-bold uppercase",children:"hs"})]})]},l.id)})})]})}),(S==null?void 0:S.records.length)===0&&e.jsx("div",{className:"py-20 bg-slate-50/30 dark:bg-black/10",children:e.jsx(qe,{icon:"search_off",title:"Sin coincidencias",message:"No encontramos alumnos con esos criterios."})}),e.jsx(we,{currentPage:d,totalPages:Math.ceil(((S==null?void 0:S.total)||0)/x),onPageChange:E,itemsPerPage:x,onItemsPerPageChange:L,totalItems:(S==null?void 0:S.total)||0})]}),j&&e.jsx(Re,{x:j.x,y:j.y,onClose:()=>H(null),options:[{label:"Editar Perfil",icon:"edit",onClick:()=>v(j.record)},{label:"Eliminar Registro",icon:"delete",variant:"danger",onClick:()=>p(j.record.id)}]}),h&&e.jsx(ve,{isOpen:!!h,onClose:()=>v(null),record:h.isCreating?null:h,tableConfig:as,onSave:(l,a)=>l?Q.mutate({id:l,fields:a}):X.mutate(a),isSaving:Q.isPending||X.isPending})]})},ls=({isOpen:I,onClose:o,onConfirm:N,sourceRecordLabel:y,isSaving:T})=>{const[u,V]=n.useState(null);return I?e.jsx("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in",onClick:o,children:e.jsxs("div",{onClick:d=>d.stopPropagation(),className:"relative w-full max-w-lg bg-white dark:bg-slate-900 rounded-[2rem] shadow-2xl border border-slate-200 dark:border-slate-800 overflow-hidden animate-scale-in",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("h3",{className:"text-xl font-black text-slate-900 dark:text-white flex items-center gap-3",children:[e.jsx("span",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-xl",children:e.jsx("span",{className:"material-icons",children:"content_copy"})}),"Duplicar Práctica"]}),e.jsxs("p",{className:"mt-4 text-sm text-slate-500 dark:text-slate-400 leading-relaxed",children:["Se creará una copia idéntica de ",e.jsx("strong",{children:y})," para el estudiante que selecciones a continuación."]})]}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Seleccionar Destinatario"}),e.jsx("div",{className:"h-12",children:e.jsx(Ve,{onStudentSelect:d=>V(d)})})]}),u&&e.jsxs("div",{className:"p-4 rounded-2xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 flex items-center justify-between animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-blue-900 dark:text-blue-100",children:u[Y]}),e.jsxs("p",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:["Legajo: ",u[ue]]})]}),e.jsx("span",{className:"material-icons text-blue-500",children:"check_circle"})]})]}),e.jsxs("div",{className:"p-6 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-6 py-3 text-sm font-bold text-slate-500 hover:text-slate-800 dark:hover:text-slate-200 transition-colors",children:"Cancelar"}),e.jsx(Ee,{onClick:()=>u&&N(u.id),disabled:!u||T,isLoading:T,className:"px-8",children:"Duplicar Ahora"})]})]})}):null},Be=({options:I,value:o,onChange:N,placeholder:y="Seleccionar...",label:T,disabled:u=!1,className:V=""})=>{const[d,E]=n.useState(!1),[x,L]=n.useState(""),C=n.useRef(null),f=n.useRef(null),h=I.find(b=>b.value===o);n.useEffect(()=>{h&&!d?L(h.label):!o&&!d&&L("")},[h,o,d]);const v=n.useMemo(()=>{if(d&&x!==(h==null?void 0:h.label)){const b=x.toLowerCase();return I.filter(p=>p.label.toLowerCase().includes(b)||p.subLabel&&p.subLabel.toLowerCase().includes(b))}return I},[I,x,d,h]);n.useEffect(()=>{const b=p=>{C.current&&!C.current.contains(p.target)&&(E(!1),L(h?h.label:""))};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[h]);const j=b=>{N(b),E(!1)},H=()=>{E(!0),f.current&&f.current.select()},R=()=>{d||E(!0)},_=b=>{b.stopPropagation(),N(""),L(""),E(!1)};return e.jsxs("div",{className:`relative ${V}`,ref:C,children:[T&&e.jsx("label",{className:"block text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-1.5 ml-1",children:T}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{ref:f,type:"text",value:x,onChange:b=>{L(b.target.value),E(!0)},onFocus:H,onClick:R,placeholder:y,disabled:u,className:`
                        w-full h-11 pl-4 pr-10 rounded-xl text-sm font-bold transition-all duration-200 outline-none
                        border-2 
                        ${u?"bg-slate-100 dark:bg-slate-800 text-slate-400 dark:text-slate-600 border-slate-200 dark:border-slate-700 cursor-not-allowed":d?"bg-white dark:bg-slate-900 border-blue-500 ring-4 ring-blue-500/10 text-slate-800 dark:text-white":"bg-slate-50 dark:bg-slate-900/50 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 hover:border-blue-300 dark:hover:border-slate-600"}
                    `}),e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[o&&!u&&e.jsx("button",{onClick:_,className:"p-0.5 rounded-full text-slate-400 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 transition-colors",children:e.jsx("span",{className:"material-icons !text-sm",children:"close"})}),e.jsx("span",{className:`material-icons !text-lg transition-transform duration-200 ${d?"rotate-180 text-blue-500":"text-slate-400"}`,children:"expand_more"})]})]}),d&&!u&&e.jsx("div",{className:"absolute z-50 mt-2 w-full bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 max-h-60 overflow-y-auto custom-scrollbar animate-fade-in-up",children:v.length>0?e.jsx("ul",{className:"py-1",children:v.map(b=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>j(b.value),className:`
                                            w-full text-left px-4 py-2.5 text-sm transition-colors flex flex-col border-b border-slate-50 dark:border-slate-700/50 last:border-0
                                            ${b.value===o?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50"}
                                        `,children:[e.jsx("span",{className:"font-bold",children:b.label}),b.subLabel&&e.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-500 font-medium",children:b.subLabel})]})},b.value))}):e.jsx("div",{className:"p-4 text-center text-xs text-slate-400 dark:text-slate-500 italic",children:"No se encontraron resultados"})})]})},ns={label:"Prácticas",tableName:Ma,schema:De.practicas,fieldConfig:[{key:W,label:"ID Estudiante",type:"text"},{key:be,label:"ID Lanzamiento",type:"text"},{key:Ne,label:"Especialidad",type:"select",options:za},{key:he,label:"Horas",type:"number"},{key:Ae,label:"Inicio",type:"date"},{key:et,label:"Fin",type:"date"},{key:Ce,label:"Estado",type:"select",options:["En curso","Finalizada","Convenio Realizado","No se pudo concretar"]},{key:Ye,label:"Nota",type:"text"},{key:J,label:"Nombre Institución",type:"text"}]},rs=({isTestingMode:I})=>{const[o,N]=n.useState(""),[y,T]=n.useState(""),[u,V]=n.useState(""),[d,E]=n.useState(""),[x,L]=n.useState(1),[C,f]=n.useState(10),[h,v]=n.useState(null),[j,H]=n.useState(null),[R,_]=n.useState(null),[b,p]=n.useState(null),[Z,S]=n.useState(null),[P,G]=n.useState(null),Q=Te(),{data:X=[]}=ce({queryKey:["institutions-filter"],queryFn:()=>g.instituciones.getAll({fields:[z]})}),{data:ie=[]}=ce({queryKey:["launches-filter",u],queryFn:async()=>{const s=X.find(k=>k.id===u);if(!s)return[];const m=ne(s[z]).split(/ [-–—] /)[0].split("(")[0].trim();return g.lanzamientos.getAll({filters:{[re]:`%${m}%`},fields:[re,de]})},enabled:!!u}),{data:q,isLoading:r}=ce({queryKey:["editor-practicas",x,C,o,u,d],queryFn:async()=>{const s={};if(o&&(s[W]=o),u){const B=X.find(te=>te.id===u);if(B){const te=ne(B[z]).split(" - ")[0].trim();s[J]=`%${te}%`}}if(d){const B=ie.find(te=>te.id===d);B&&B[de]?s[Ae]=B[de]:s[be]=d}const{records:i,total:m,error:k}=await g.practicas.getPage(x,C,{filters:s});if(k)throw k;const w=i.map(B=>{const te=B[W];return Array.isArray(te)&&te.length>0?te[0]:fe(te)}).filter(Boolean),ee=Array.from(new Set(w)),se=await g.estudiantes.getAll({filters:{id:ee},fields:[Y,ue]}),st=new Map(se.map(B=>[B.id,B]));return{records:i.map(B=>({...B,[J]:ne(B[J]),__student:st.get(fe(B[W])||"")||{nombre:"Desconocido",legajo:"---"}})),total:m}}}),D=s=>{const i={...s};return i[W]&&(i[W]=fe(i[W])),i[be]&&(i[be]=fe(i[be])),i[J]&&(i[J]=ne(i[J])),i},l=K({mutationFn:s=>g.practicas.update(s.id,D(s.fields)),onSuccess:()=>{Q.invalidateQueries({queryKey:["editor-practicas"]}),S({message:"Registro actualizado",type:"success"}),_(null)}}),a=K({mutationFn:s=>g.practicas.create(D(s)),onSuccess:()=>{Q.invalidateQueries({queryKey:["editor-practicas"]}),S({message:"Registro creado",type:"success"}),_(null)}}),c=K({mutationFn:async({record:s,targetStudentId:i})=>{const{id:m,created_at:k,createdTime:w,...ee}=s,se=D(ee);return se[W]=i,delete se.__student,delete se.__studentName,g.practicas.create(se)},onSuccess:()=>{Q.invalidateQueries({queryKey:["editor-practicas"]}),S({message:"Práctica duplicada",type:"success"}),p(null)}}),A=K({mutationFn:s=>g.practicas.delete(s),onSuccess:()=>{Q.invalidateQueries({queryKey:["editor-practicas"]}),S({message:"Registro eliminado",type:"success"}),G(null),v(null)}}),U=(s,i)=>{s.preventDefault(),H({x:s.clientX,y:s.clientY,record:i}),v(i.id)},M=X.map(s=>({value:s.id,label:ne(s[z])})).sort((s,i)=>s.label.localeCompare(i.label)),F=ie.map(s=>({value:s.id,label:Pe(s[de])+(s[re]?` - ${s[re]}`:"")}));return e.jsxs("div",{className:"space-y-6",children:[Z&&e.jsx(je,{message:Z.message,type:Z.type,onClose:()=>S(null)}),e.jsx(Fe,{isOpen:!!P,title:"¿Eliminar Práctica?",message:"Se borrará el registro. ¿Confirmar?",confirmText:"Eliminar",type:"danger",onConfirm:()=>P&&A.mutate(P),onClose:()=>G(null)}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800 grid grid-cols-1 md:grid-cols-12 gap-4 items-end shadow-sm",children:[e.jsx("div",{className:"md:col-span-3 space-y-1.5 h-full",children:o?e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest ml-1",children:"Alumno"}),e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 h-11 px-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[e.jsx("span",{className:"text-xs font-bold truncate text-blue-800 dark:text-blue-300",children:y}),e.jsx("button",{onClick:()=>N(""),className:"material-icons !text-sm text-blue-500 hover:text-blue-700",children:"close"})]})]}):e.jsxs("div",{className:"h-full",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest ml-1 mb-1.5 block",children:"Alumno"}),e.jsx("div",{className:"h-11",children:e.jsx(Ve,{onStudentSelect:s=>{N(s.id),T(s[Y]||"")}})})]})}),e.jsx("div",{className:"md:col-span-4",children:e.jsx(Be,{label:"Institución",options:[{value:"",label:"Todas"},...M],value:u,onChange:s=>{V(s),E("")},placeholder:"Buscar institución...",className:"w-full"})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(Be,{label:"Fecha / Convocatoria",options:[{value:"",label:"Todas"},...F],value:d,onChange:E,placeholder:u?"Seleccionar fecha...":"Selecciona Inst. primero",disabled:!u,className:"w-full"})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(Ee,{onClick:()=>_({isCreating:!0}),icon:"add_circle",className:"h-11 bg-blue-600 hover:bg-blue-700 w-full shadow-md",children:"Nueva"})})]}),e.jsx("div",{className:"flex justify-end h-8",children:h&&e.jsxs("button",{onClick:()=>G(h),className:"flex items-center gap-2 px-4 py-1.5 bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 rounded-lg text-xs font-black uppercase border border-rose-200 dark:border-rose-800 animate-fade-in hover:bg-rose-100 dark:hover:bg-rose-900/40 transition-colors",children:[e.jsx("span",{className:"material-icons !text-sm",children:"delete"})," Eliminar"]})}),r?e.jsx("div",{className:"py-12",children:e.jsx(Le,{})}):e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl overflow-hidden bg-white dark:bg-[#020617] shadow-xl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-800 text-slate-500 dark:text-slate-400 uppercase text-[10px] font-black tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Institución"}),e.jsx("th",{className:"px-6 py-4",children:"Estudiante"}),e.jsx("th",{className:"px-6 py-4",children:"Inicio"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Horas"}),e.jsx("th",{className:"px-6 py-4",children:"Estado"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:q==null?void 0:q.records.map(s=>{const i=h===s.id,m=at(s[Ne]);return e.jsxs("tr",{onClick:()=>v(i?null:s.id),onContextMenu:k=>U(k,s),onDoubleClick:()=>_(s),className:`transition-all cursor-pointer group ${i?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-slate-50/80 dark:hover:bg-slate-900/40"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:`font-black truncate max-w-[250px] ${m.headerText}`,children:ne(s[J])})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-bold text-slate-700 dark:text-slate-300",children:s.__student.nombre}),e.jsx("div",{className:"text-[10px] font-mono text-slate-500 dark:text-slate-400",children:s.__student.legajo})]}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs text-slate-600 dark:text-slate-400",children:Pe(s[Ae])}),e.jsxs("td",{className:"px-6 py-4 text-center font-black text-blue-600 dark:text-blue-400",children:[s[he]," hs"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-black border uppercase ${Pa(s[Ce]).labelClass}`,children:s[Ce]})})]},s.id)})})]})}),e.jsx(we,{currentPage:x,totalPages:Math.ceil(((q==null?void 0:q.total)||0)/C),onPageChange:L,itemsPerPage:C,onItemsPerPageChange:f,totalItems:(q==null?void 0:q.total)||0})]}),j&&e.jsx(Re,{x:j.x,y:j.y,onClose:()=>H(null),options:[{label:"Editar",icon:"edit",onClick:()=>_(j.record)},{label:"Duplicar a otro",icon:"content_copy",onClick:()=>p(j.record)},{label:"Eliminar",icon:"delete",variant:"danger",onClick:()=>G(j.record.id)}]}),R&&e.jsx(ve,{isOpen:!!R,onClose:()=>_(null),record:R.isCreating?null:R,tableConfig:ns,onSave:(s,i)=>s?l.mutate({id:s,fields:i}):a.mutate(i),isSaving:l.isPending||a.isPending}),b&&e.jsx(ls,{isOpen:!!b,onClose:()=>p(null),sourceRecordLabel:ne(b[J]),onConfirm:s=>c.mutate({record:b,targetStudentId:s}),isSaving:c.isPending})]})},os={label:"Inscripciones",tableName:Ua,schema:De.convocatorias,searchFields:[Me],fieldConfig:[{key:ge,label:"ID Estudiante",type:"text"},{key:Ie,label:"ID Lanzamiento",type:"text"},{key:Oe,label:"Estado",type:"select",options:["Inscripto","Seleccionado","No Seleccionado","Baja"]},{key:ke,label:"Horario Asignado",type:"text"}]},is=I=>{const o=(I||"").toLowerCase();return o.includes("seleccionado")&&!o.includes("no")?"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800":o.includes("inscripto")?"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800":o.includes("no seleccionado")?"bg-rose-100 text-rose-700 border-rose-200 dark:bg-rose-900/30 dark:text-rose-400 dark:border-rose-800":o.includes("baja")?"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800":"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700"},ds=({isTestingMode:I})=>{const[o,N]=n.useState(""),[y,T]=n.useState(""),[u,V]=n.useState(""),[d,E]=n.useState(1),[x,L]=n.useState(10),[C,f]=n.useState(null),[h,v]=n.useState(null),[j,H]=n.useState(null),[R,_]=n.useState(null),[b,p]=n.useState(null),Z=Te(),{data:S=[]}=ce({queryKey:["launches-filter-list"],queryFn:()=>g.lanzamientos.getAll({fields:[re,de],sort:[{field:de,direction:"desc"}]})}),{data:P,isLoading:G}=ce({queryKey:["editor-convocatorias",d,x,o,u],queryFn:async()=>{const r={};o&&(r[ge]=o),u&&(r[Ie]=u);const{records:D,total:l,error:a}=await g.convocatorias.getPage(d,x,{filters:r,sort:{field:"created_at",direction:"desc"}});if(a)throw a;const c=D.map(m=>m[ge]).filter(Boolean),A=D.map(m=>m[Ie]).filter(Boolean),[U,M]=await Promise.all([g.estudiantes.getAll({filters:{id:c},fields:[Y]}),g.lanzamientos.getAll({filters:{id:A},fields:[re]})]),F=new Map(U.map(m=>[m.id,m])),s=new Map(M.map(m=>[m.id,m]));return{records:D.map(m=>{const k=m[ge],w=m[Ie],ee=k?F.get(k):null,se=w?s.get(w):null;return{...m,__studentName:ee?ee[Y]:"Desconocido",__ppsName:se?se[re]:m[Me]||"N/A"}}),total:l}}}),Q=K({mutationFn:r=>g.convocatorias.update(r.id,r.fields),onSuccess:()=>{Z.invalidateQueries({queryKey:["editor-convocatorias"]}),H({message:"Inscripción actualizada",type:"success"}),f(null)}}),X=K({mutationFn:r=>g.convocatorias.create(r),onSuccess:()=>{Z.invalidateQueries({queryKey:["editor-convocatorias"]}),H({message:"Inscripción creada",type:"success"}),f(null)}}),ie=K({mutationFn:r=>g.convocatorias.delete(r),onSuccess:()=>{Z.invalidateQueries({queryKey:["editor-convocatorias"]}),H({message:"Inscripción eliminada",type:"success"}),_(null),p(null)},onError:()=>{H({message:"Error al eliminar",type:"error"}),_(null)}}),q=(r,D)=>{r.preventDefault(),v({x:r.clientX,y:r.clientY,record:D}),p(D.id)};return e.jsxs("div",{className:"space-y-6",children:[j&&e.jsx(je,{message:j.message,type:j.type,onClose:()=>H(null)}),e.jsx(Fe,{isOpen:!!R,title:"¿Eliminar Inscripción?",message:"Esta acción eliminará el registro de inscripción. No se puede deshacer.",confirmText:"Eliminar Definitivamente",cancelText:"Cancelar",type:"danger",onConfirm:()=>R&&ie.mutate(R),onClose:()=>_(null)}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl border border-slate-200 dark:border-slate-700 grid grid-cols-1 md:grid-cols-3 gap-6 items-end shadow-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-400 dark:text-indigo-300 uppercase tracking-widest ml-1",children:"Estudiante"}),o?e.jsxs("div",{className:"flex items-center justify-between bg-indigo-50 dark:bg-indigo-900/20 h-11 px-4 rounded-xl border border-indigo-200 dark:border-indigo-800",children:[e.jsx("span",{className:"text-xs font-bold truncate text-indigo-800 dark:text-indigo-300",children:y}),e.jsx("button",{onClick:()=>N(""),className:"material-icons !text-sm text-indigo-400 hover:text-indigo-600 transition-colors",children:"close"})]}):e.jsx("div",{className:"h-11",children:e.jsx(Ve,{onStudentSelect:r=>{N(r.id),T(r[Y]||"")}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-400 dark:text-indigo-300 uppercase tracking-widest ml-1",children:"Lanzamiento / PPS"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:u,onChange:r=>V(r.target.value),className:"w-full h-11 pl-4 pr-10 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl text-sm font-bold focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none appearance-none transition-all text-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"",children:"Todas las convocatorias"}),S.map(r=>e.jsxs("option",{value:r.id,children:[r[re]," (",Pe(r[de]),")"]},r.id))]}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 material-icons text-slate-400 pointer-events-none",children:"expand_more"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Ee,{onClick:()=>f({isCreating:!0}),icon:"add_card",className:"h-11 w-full md:w-auto bg-indigo-600 hover:bg-indigo-700",children:"Nueva Inscripción"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>b&&_(b),disabled:!b,className:`bg-white border border-rose-300 text-rose-600 font-bold py-2 px-5 rounded-lg text-sm flex items-center justify-center gap-2 transition-all ${b?"hover:bg-rose-50 shadow-sm":"opacity-50 cursor-not-allowed"}`,children:[e.jsx("span",{className:"material-icons !text-lg",children:"delete"}),"Eliminar"]})}),G?e.jsx("div",{className:"py-12",children:e.jsx(Le,{})}):e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-3xl overflow-hidden bg-white dark:bg-slate-900 shadow-lg",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-indigo-50/70 dark:bg-indigo-900/10 border-b border-indigo-100 dark:border-indigo-800 text-indigo-700 dark:text-indigo-300 uppercase text-[10px] font-black tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Estudiante"}),e.jsx("th",{className:"px-6 py-4",children:"Convocatoria PPS"}),e.jsx("th",{className:"px-6 py-4",children:"Horario"}),e.jsx("th",{className:"px-6 py-4",children:"Estado"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:P==null?void 0:P.records.map(r=>{const D=is(r[Oe]),l=b===r.id;return e.jsxs("tr",{className:`transition-colors cursor-pointer group ${l?"bg-blue-100 dark:bg-blue-900/40 ring-1 ring-inset ring-blue-300 dark:ring-blue-700":"hover:bg-slate-50 dark:hover:bg-slate-800/50"}`,onClick:()=>p(l?null:r.id),onDoubleClick:()=>f(r),onContextMenu:a=>q(a,r),children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-indigo-100 to-white dark:from-indigo-900 dark:to-slate-800 flex items-center justify-center text-indigo-600 dark:text-indigo-300 text-sm font-bold border border-indigo-100 dark:border-indigo-800 shadow-sm",children:(r.__studentName||"?").charAt(0)}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-100 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors",children:r.__studentName})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-icons text-slate-300 !text-base mt-0.5",children:"business"}),e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300 text-xs sm:text-sm truncate max-w-[280px]",title:r.__ppsName,children:r.__ppsName})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 px-2.5 py-1.5 rounded-lg border border-slate-100 dark:border-slate-700 inline-block max-w-[200px] truncate",title:r[ke],children:[e.jsx("span",{className:"material-icons !text-xs opacity-60",children:"schedule"}),r[ke]||"Sin horario"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-wide shadow-sm ${D}`,children:r[Oe]||"Pendiente"})})]},r.id)})})]})}),e.jsx(we,{currentPage:d,totalPages:Math.ceil(((P==null?void 0:P.total)||0)/x),onPageChange:E,itemsPerPage:x,onItemsPerPageChange:L,totalItems:(P==null?void 0:P.total)||0})]}),h&&e.jsx(Re,{x:h.x,y:h.y,onClose:()=>v(null),options:[{label:"Editar Inscripción",icon:"edit",onClick:()=>f(h.record)},{label:"Eliminar",icon:"delete",variant:"danger",onClick:()=>_(h.record.id)}]}),C&&e.jsx(ve,{isOpen:!!C,onClose:()=>f(null),record:C.isCreating?null:C,tableConfig:os,onSave:(r,D)=>r?Q.mutate({id:r,fields:D}):X.mutate(D),isSaving:Q.isPending||X.isPending})]})},Ze={label:"Instituciones",tableName:Va,schema:De.instituciones,searchFields:[z,ye],fieldConfig:[{key:z,label:"Nombre",type:"text"},{key:tt,label:"Teléfono",type:"tel"},{key:ye,label:"Dirección",type:"text"},{key:le,label:"Año del Convenio",type:"select",options:["2024","2025","2026","Legacy","No"]},{key:Ue,label:"Tutor",type:"text"},{key:xe,label:"Orientaciones (Calc. Automático)",type:"text"}]},cs=["Banco Provincia del Neuquen","Centro de Inclusión Social y Laboral APASIDO","Colegio Nuestra Señora de Fátima","Colegio San José Obrero de Neuquén","Escuela Cristiana Vida","Ministerio de Trabajo y Desarrollo Laboral"],us=["Centro Evaluador Camioneros","Colegio Psicólogos CPAVZO","Consultorios Las Lilas","Corporate Resources","Escuela de Formación Cooperativa y Laboral N8","Fundación Kano","Hospital Centenario Natalio Burd","Institución Fernando Ulloa","Instituto de Formación Docente N4","Randstad","Sanatorio Juan XXIII","Subsecretaría de Familia","Clinica Fava","ACUCADES"],bs=({isTestingMode:I})=>{const[o,N]=n.useState(""),[y,T]=n.useState(1),[u,V]=n.useState(10),[d,E]=n.useState(null),[x,L]=n.useState(null),[C,f]=n.useState(null),[h,v]=n.useState(!1),[j,H]=n.useState(!1),[R,_]=n.useState(null),b=Te(),{data:p,isLoading:Z}=ce({queryKey:["editor-instituciones",y,u,o],queryFn:async()=>{const a=await g.instituciones.getPage(y,u,{searchTerm:o,searchFields:Ze.searchFields,sort:{field:le,direction:"desc"}});return a.records&&(a.records=a.records.filter(c=>!String(c[z]||"").toUpperCase().startsWith("UFLO -"))),a}}),S=a=>{console.error(a),f({message:`Error: ${a.message}`,type:"error"})},P=K({mutationFn:a=>{let c=a.fields[le];(c==="No"||c==="false")&&(c=null),(c==="Legacy"||c==="true")&&(c="Legacy");const A={...a.fields,[le]:c};return g.instituciones.update(a.id,A)},onSuccess:()=>{b.invalidateQueries({queryKey:["editor-instituciones"]}),f({message:"Institución actualizada",type:"success"}),E(null)},onError:S}),G=K({mutationFn:a=>g.instituciones.create(a),onSuccess:()=>{b.invalidateQueries({queryKey:["editor-instituciones"]}),f({message:"Institución creada",type:"success"}),E(null)},onError:S}),Q=K({mutationFn:a=>g.instituciones.delete(a),onSuccess:()=>{b.invalidateQueries({queryKey:["editor-instituciones"]}),f({message:"Institución eliminada",type:"success"}),_(null)},onError:a=>{S(a),_(null)}}),X=async()=>{v(!0);try{const a=await g.instituciones.getAll({fields:[z,le]}),c=[],A=(M,F)=>{for(const s of M){const i=Se(s),m=a.filter(k=>{const w=String(k[z]||"");if(w.toUpperCase().startsWith("UFLO -"))return!1;const ee=Se(w);return ee.includes(i)||i.includes(ee)});for(const k of m)String(k[le])!==F&&c.push({id:k.id,fields:{[le]:F}})}};A(cs,"2024"),A(us,"2025");const U=Array.from(new Map(c.map(M=>[M.id,M])).values());U.length>0?(await g.instituciones.updateMany(U),b.invalidateQueries({queryKey:["editor-instituciones"]}),f({message:`Se actualizaron ${U.length} convenios.`,type:"success"})):f({message:"No hay nuevas instituciones para actualizar.",type:"info"})}catch(a){S(a)}finally{v(!1)}},ie=async()=>{H(!0);try{const[a,c]=await Promise.all([g.instituciones.getAll({fields:[z,xe]}),g.practicas.getAll({fields:[J,Ne]})]),A=new Map;c.forEach(M=>{const F=ne(M[J]),s=M[Ne];if(F&&s){const i=Se(F.split("-")[0].trim()),m=Ha(s.trim());A.has(i)||A.set(i,new Set),A.get(i).add(m)}});const U=[];for(const M of a){const F=M[z];if(!F||String(F).toUpperCase().startsWith("UFLO -"))continue;const s=Se(F);let i=new Set;if(A.has(s))i=A.get(s);else for(const[m,k]of A.entries())m.length>3&&s.includes(m)&&k.forEach(w=>i.add(w));if(i.size>0){const w=Array.from(i).sort().slice(0,4).join(", ");String(M[xe]||"").trim()!==w&&U.push({id:M.id,fields:{[xe]:w}})}}if(U.length>0){for(let F=0;F<U.length;F+=50)await g.instituciones.updateMany(U.slice(F,F+50));b.invalidateQueries({queryKey:["editor-instituciones"]}),f({message:"Orientaciones actualizadas y limpias.",type:"success"})}else f({message:"Todo sincronizado.",type:"success"})}catch(a){S(a)}finally{H(!1)}},q=(a,c)=>{a.preventDefault(),L({x:a.clientX,y:a.clientY,record:c})},r=a=>{if(!a)return"";const c=String(a).toLowerCase().trim();return c==="2026"?"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800":c==="2025"?"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/30 dark:text-purple-400 dark:border-purple-800":c==="2024"?"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800":c==="legacy"||c==="true"?"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800":"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700"},D=a=>{if(!a||a==="false")return e.jsx("span",{className:"text-slate-300 text-xs",children:"-"});let c=String(a);return c==="true"&&(c="Legacy"),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-black border shadow-sm ${r(c)}`,children:[e.jsx("span",{className:"material-icons !text-xs",children:"verified"}),c]})},l=a=>{if(!a)return e.jsx("span",{className:"text-slate-300 text-xs italic",children:"Sin especificar"});const c=String(a).split(",").map(A=>A.trim()).filter(Boolean);return e.jsx("div",{className:"flex flex-wrap gap-1 max-w-[200px]",children:c.map((A,U)=>e.jsx("span",{className:`${at(A).tag} px-1.5 py-0.5 rounded text-[10px] font-semibold border shadow-none truncate max-w-full`,children:A},U))})};return e.jsxs("div",{className:"space-y-6",children:[C&&e.jsx(je,{message:C.message,type:C.type,onClose:()=>f(null)}),e.jsx(Fe,{isOpen:!!R,title:"¿Eliminar Institución?",message:"Esta acción eliminará la institución. No se puede deshacer.",confirmText:"Eliminar Definitivamente",cancelText:"Cancelar",type:"danger",onConfirm:()=>R&&Q.mutate(R),onClose:()=>_(null)}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl border border-slate-200 dark:border-slate-700 flex flex-col md:flex-row justify-between items-end gap-6 shadow-sm",children:[e.jsxs("div",{className:"relative flex-1 w-full md:w-auto space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-400 dark:text-indigo-300 uppercase tracking-widest ml-1",children:"Buscador"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"search",placeholder:"Buscar Institución...",value:o,onChange:a=>N(a.target.value),className:"w-full h-11 pl-10 pr-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl text-sm font-bold focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 dark:text-slate-100"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 material-icons text-slate-400 !text-lg",children:"search"})]})]}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto flex-wrap justify-end",children:[e.jsxs("button",{onClick:ie,disabled:j,className:"h-11 px-4 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 rounded-xl font-bold text-xs border border-blue-100 dark:border-blue-800 flex items-center gap-2 hover:bg-blue-100 transition-colors",children:[j?e.jsx("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx("span",{className:"material-icons !text-base",children:"sync"}),"Sincronizar Orientaciones"]}),e.jsxs("button",{onClick:X,disabled:h,className:"h-11 px-4 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-300 rounded-xl font-bold text-xs border border-indigo-100 dark:border-indigo-800 flex items-center gap-2 hover:bg-indigo-100 transition-colors",children:[h?e.jsx("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx("span",{className:"material-icons !text-base",children:"auto_fix_high"}),"Asignar Años"]}),e.jsx(Ee,{onClick:()=>E({isCreating:!0}),icon:"add_business",className:"h-11 bg-indigo-600 hover:bg-indigo-700",children:"Nueva"})]})]}),Z?e.jsx("div",{className:"py-12",children:e.jsx(Le,{})}):e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-3xl overflow-hidden bg-white dark:bg-slate-900 shadow-lg",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-indigo-50/70 dark:bg-indigo-900/10 border-b border-indigo-100 dark:border-indigo-800 text-indigo-700 dark:text-indigo-300 uppercase text-[10px] font-black tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Institución"}),e.jsx("th",{className:"px-6 py-4",children:"Orientaciones"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Año Convenio"}),e.jsx("th",{className:"px-6 py-4",children:"Referente"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:p==null?void 0:p.records.map(a=>e.jsxs("tr",{onContextMenu:c=>q(c,a),className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-context-menu group",onDoubleClick:()=>E(a),children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-extrabold text-slate-800 dark:text-slate-100 text-base mb-1",children:ne(a[z])}),e.jsx("div",{className:"text-xs text-slate-500",children:a[ye]})]}),e.jsx("td",{className:"px-6 py-4",children:l(a[xe])}),e.jsx("td",{className:"px-6 py-4 text-center",children:D(a[le])}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300 font-medium",children:a[Ue]||"No asignado"})})]},a.id))})]})}),e.jsx(we,{currentPage:y,totalPages:Math.ceil(((p==null?void 0:p.total)||0)/u),onPageChange:T,itemsPerPage:u,onItemsPerPageChange:V,totalItems:(p==null?void 0:p.total)||0})]}),x&&e.jsx(Re,{x:x.x,y:x.y,onClose:()=>L(null),options:[{label:"Editar",icon:"edit",onClick:()=>E(x.record)},{label:"Eliminar",icon:"delete",variant:"danger",onClick:()=>_(x.record.id)}]}),d&&e.jsx(ve,{isOpen:!!d,onClose:()=>E(null),record:d.isCreating?null:d,tableConfig:Ze,onSave:(a,c)=>a?P.mutate({id:a,fields:c}):G.mutate(c),isSaving:P.isPending||G.isPending})]})},_s=({isTestingMode:I=!1})=>{const[o,N]=n.useState("estudiantes"),y=[{id:"estudiantes",label:"Estudiantes",icon:"school"},{id:"convocatorias",label:"Inscripciones",icon:"how_to_reg"},{id:"practicas",label:"Prácticas",icon:"work_history"},{id:"instituciones",label:"Instituciones",icon:"apartment"}];return e.jsxs(qa,{title:"Editor de Base de Datos",icon:"storage",className:"border-slate-200 dark:border-slate-700 bg-white dark:bg-[#0F172A] shadow-lg",children:[e.jsx("div",{className:"mt-4",children:e.jsx(Ba,{tabs:y,activeTabId:o,onTabChange:T=>N(T)})}),e.jsxs("div",{className:"mt-6 pt-2",children:[o==="estudiantes"&&e.jsx(ss,{isTestingMode:I}),o==="practicas"&&e.jsx(rs,{isTestingMode:I}),o==="convocatorias"&&e.jsx(ds,{isTestingMode:I}),o==="instituciones"&&e.jsx(bs,{isTestingMode:I})]})]})};export{_s as default};
