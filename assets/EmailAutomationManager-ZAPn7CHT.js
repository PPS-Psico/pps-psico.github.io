import{g as R,r,O as U,i as _,T as b,j as a,aP as Q,a5 as V,ar as w,as as f}from"./index-ZXlslG1z.js";import{g as G,a as K}from"./emailService-DD1-Dxe1.js";import{S as J}from"./Select-DhRNnplj.js";const c=[{id:"seleccion",label:"Alumno Seleccionado",description:'Se env√≠a cuando marcas a un estudiante como "Seleccionado" en una convocatoria.',icon:"how_to_reg",variables:["{{nombre_alumno}}","{{nombre_pps}}","{{horario}}"],defaultSubject:"Confirmaci√≥n de Asignaci√≥n PPS: {{nombre_pps}} üéì",defaultBody:`Hola {{nombre_alumno}},

Espero que est√©s muy bien.

Nos complace informarte que has sido seleccionado/a para realizar tu Pr√°ctica Profesional Supervisada en:

Instituci√≥n: {{nombre_pps}}
Horario/Comisi√≥n asignada: {{horario}}

üí° Recomendaciones para tu Pr√°ctica

**Puntualidad y Asistencia:** La puntualidad es la primera se√±al de compromiso profesional. Si surge un imprevisto de fuerza mayor, avis√° con la mayor antelaci√≥n posible tanto a la instituci√≥n como a la Universidad. Record√° que faltar sin previo aviso es motivo suficiente de suspensi√≥n de la PPS.

**√âtica y Confidencialidad:** Vas a trabajar con personas y, en muchos casos, con informaci√≥n sensible. El secreto profesional y el respeto por la privacidad son fundamentales desde el primer momento.

**Rol Activo:** No te quedes solo con "observar". Pregunt√°, mostr√° inter√©s, llev√° cuaderno para anotar y particip√° de los espacios de supervisi√≥n. La PPS te devuelve lo que vos le pongas de energ√≠a.

**Documentaci√≥n Final:** No te olvides de terminar la PPS con tu planilla de asistencia firmada y conservarla (exceptuando las Online que no se firma). Record√° que ten√©s 30 d√≠as para la entrega del informe final una vez finalizada la PPS.

Por favor, respondenos a este correo confirmando que recibiste la informaci√≥n y que acept√°s la vacante asignada.

¬°Te deseamos un excelente comienzo!

Saludos,

Blas
Coordinador de Pr√°cticas Profesionales Supervisadas
Licenciatura en Psicolog√≠a
UFLO`},{id:"solicitud",label:"Avance de Solicitud (Autogesti√≥n)",description:'Se env√≠a cuando actualizas el estado de una solicitud de PPS (ej: a "En conversaciones").',icon:"assignment_turned_in",variables:["{{nombre_alumno}}","{{estado_nuevo}}","{{institucion}}","{{notas}}"],defaultSubject:"Actualizaci√≥n de tu Solicitud de PPS - UFLO",defaultBody:`Hola {{nombre_alumno}},

Hay novedades sobre tu solicitud de PPS en "{{institucion}}".

Nuevo Estado: {{estado_nuevo}}

Comentarios:
{{notas}}

Seguimos gestionando tu solicitud.`},{id:"sac",label:"Carga en SAC / Finalizaci√≥n",description:"Se env√≠a cuando se confirma la carga de horas en el sistema acad√©mico.",icon:"school",variables:["{{nombre_alumno}}","{{nombre_pps}}"],defaultSubject:"Acreditaci√≥n de Pr√°cticas en SAC ‚úÖ",defaultBody:`Hola {{nombre_alumno}},

Queremos avisarte que tus horas de la PPS "{{nombre_pps}}" fueron acreditadas correctamente y ya pod√©s visualizarlas en el sistema SAC.

¬°Felicitaciones por la finalizaci√≥n de esta etapa!

Saludos,

Blas
Coordinador de Pr√°cticas Profesionales Supervisadas
Licenciatura en Psicolog√≠a
UFLO`}],ee=()=>{const v=R(),[p,i]=r.useState(null),[x,A]=r.useState(""),[h,E]=r.useState("seleccion"),[j,y]=r.useState(!1),[T,u]=r.useState(null),[S,N]=r.useState(""),[g,m]=r.useState(""),{data:q=[],isLoading:I}=U({queryKey:["emailTemplates"],queryFn:async()=>{const{data:e,error:s}=await b.from("email_templates").select("*");if(s)throw s;return e}}),k=_({mutationFn:async e=>{const{error:s}=await b.from("email_templates").upsert({id:e.id,subject:e.subject,body:e.body,is_active:e.is_active,updated_at:new Date().toISOString()});if(s)throw s},onSuccess:()=>{v.invalidateQueries({queryKey:["emailTemplates"]}),i({message:"Plantilla guardada correctamente.",type:"success"}),u(null)},onError:e=>{i({message:`Error guardando: ${e.message}`,type:"error"})}}),P=_({mutationFn:async e=>{const{error:s}=await b.from("email_templates").upsert({id:e.id,is_active:e.is_active,subject:e.subject,body:e.body});if(s)throw s},onSuccess:()=>{v.invalidateQueries({queryKey:["emailTemplates"]})},onError:e=>i({message:`Error cambiando estado: ${e.message}`,type:"error"})}),d=e=>{const s=q.find(o=>o.id===e),t=c.find(o=>o.id===e);return{subject:(s==null?void 0:s.subject)||(t==null?void 0:t.defaultSubject)||"",body:(s==null?void 0:s.body)||(t==null?void 0:t.defaultBody)||"",isActive:s?s.is_active:!1}},z=async()=>{if(!x){i({message:"Ingresa un correo para la prueba.",type:"error"});return}y(!0);try{const e=c.find(M=>M.id===h)||c[0],{subject:s,body:t}=d(e.id),o="Estudiante de Prueba";let l=t.replace("{{nombre_alumno}}",o),n=s;e.id==="seleccion"?(l=l.replace("{{nombre_pps}}","Cl√≠nica Demo UFLO").replace("{{horario}}","Lunes 14hs"),n=n.replace("{{nombre_pps}}","Cl√≠nica Demo")):e.id==="solicitud"?(l=l.replace("{{institucion}}","Hospital Modelo").replace("{{estado_nuevo}}","En conversaciones").replace("{{notas}}","Hemos contactado a la instituci√≥n y esperamos respuesta."),n=n.replace("{{institucion}}","Hospital Modelo")):e.id==="sac"&&(l=l.replace("{{nombre_pps}}","Pr√°ctica Profesional Supervisada"));const H=`Hola, <span style="color: #2563eb;">${o.split(" ")[0]}</span>`,O=G(l,H),D=K(l),{error:C}=await b.functions.invoke("send-email",{body:{to:x,subject:`[PRUEBA] ${n}`,text:D,html:O,name:o}});if(C)throw C;i({message:`Prueba de "${e.label}" enviada.`,type:"success"})}catch(e){console.error("Error sending test:",e),i({message:`Fallo el env√≠o: ${e.message||"Error desconocido"}`,type:"error"})}finally{y(!1)}},B=e=>{u(e.id);const s=d(e.id);N(s.subject),m(s.body)},L=e=>{const s=d(e.id);k.mutate({id:e.id,subject:S,body:g,is_active:s.isActive})},$=e=>{const s=d(e.id);P.mutate({id:e.id,is_active:!s.isActive,subject:s.subject,body:s.body})},F=e=>{const s=document.getElementById("body-editor");if(s){const t=s.selectionStart,o=s.selectionEnd,l=g,n=l.substring(0,t)+e+l.substring(o);m(n),setTimeout(()=>{s.focus(),s.selectionStart=s.selectionEnd=t+e.length},0)}else m(t=>t+e)};return I?a.jsx(Q,{}):a.jsxs("div",{className:"space-y-8 animate-fade-in-up pb-10",children:[p&&a.jsx(V,{message:p.message,type:p.type,onClose:()=>i(null)}),a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsx("div",{className:"p-3 rounded-full bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400",children:a.jsx("span",{className:"material-icons !text-2xl",children:"mark_email_read"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Gestor de Correos Automatizados"}),a.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Configura el contenido y activa/desactiva los env√≠os autom√°ticos. Los cambios se guardan en la base de datos y son compartidos."})]})]}),a.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-200 dark:border-slate-700",children:[a.jsx("h4",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:"Diagn√≥stico y Pruebas"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Plantilla a probar:"}),a.jsx(J,{value:h,onChange:e=>E(e.target.value),className:"w-full text-sm",children:c.map(e=>a.jsx("option",{value:e.id,children:e.label},e.id))})]}),a.jsxs("div",{className:"flex gap-2 w-full",children:[a.jsxs("div",{className:"flex-grow",children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Enviar a:"}),a.jsx(w,{value:x,onChange:e=>A(e.target.value),placeholder:"tu_correo@ejemplo.com",className:"text-sm"})]}),a.jsx(f,{onClick:z,disabled:j,size:"md",icon:"send",variant:"secondary",children:j?"...":"Probar"})]})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-4",children:"Plantillas de Notificaci√≥n"}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:c.map(e=>{const s=T===e.id,{isActive:t}=d(e.id);return a.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-xl border shadow-sm transition-all ${t?"border-blue-200 dark:border-blue-800":"border-slate-200 dark:border-slate-700 opacity-90"}`,children:[a.jsxs("div",{className:"p-5 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:`p-3 rounded-full ${t?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400"}`,children:a.jsx("span",{className:"material-icons !text-2xl",children:e.icon})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:e.label}),a.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-0.5 max-w-xl",children:e.description})]})]}),a.jsxs("div",{className:"flex items-center gap-4 self-end sm:self-center",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`text-xs font-bold ${t?"text-blue-600 dark:text-blue-400":"text-slate-400"}`,children:t?"ACTIVADO":"DESACTIVADO"}),a.jsx("button",{onClick:()=>$(e),disabled:P.isPending,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ${t?"bg-blue-600":"bg-slate-300 dark:bg-slate-600"}`,children:a.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]}),a.jsx("button",{onClick:()=>s?u(null):B(e),className:`p-2 rounded-lg border transition-colors ${s?"bg-blue-50 border-blue-200 text-blue-700":"border-slate-200 hover:bg-slate-50 text-slate-600 dark:border-slate-700 dark:hover:bg-slate-700 dark:text-slate-300"}`,children:a.jsx("span",{className:"material-icons !text-xl",children:s?"expand_less":"edit"})})]})]}),s&&a.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 p-6 bg-slate-50/50 dark:bg-slate-900/30 animate-fade-in",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1.5",children:"Asunto del Correo"}),a.jsx(w,{value:S,onChange:o=>N(o.target.value),placeholder:"Asunto..."})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase",children:"Cuerpo del Mensaje (Soporta **negrita** para t√≠tulos)"}),a.jsx("div",{className:"flex gap-1",children:e.variables.map(o=>a.jsx("button",{onClick:()=>F(o),className:"text-[10px] bg-slate-200 dark:bg-slate-700 hover:bg-blue-100 hover:text-blue-700 dark:hover:bg-blue-900/50 dark:hover:text-blue-300 px-2 py-0.5 rounded cursor-pointer transition-colors",title:"Insertar variable",children:o},o))})]}),a.jsxs("div",{className:"text-xs text-slate-400 mb-2 px-2 border-l-2 border-blue-200",children:["Tip: Usa ",a.jsx("strong",{children:"**T√≠tulo:**"})," para crear cajas de alerta visuales con √≠conos.",a.jsx("br",{}),'Nota: No incluyas el saludo inicial ("Hola..."), el sistema lo agrega autom√°ticamente.']}),a.jsx("textarea",{id:"body-editor",value:g,onChange:o=>m(o.target.value),rows:16,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none font-mono leading-relaxed"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(f,{variant:"secondary",size:"sm",onClick:()=>u(null),children:"Cancelar"}),a.jsx(f,{variant:"primary",size:"sm",onClick:()=>L(e),isLoading:k.isPending,icon:"save",children:"Guardar Cambios"})]})]})})]},e.id)})})]})]})};export{ee as default};
