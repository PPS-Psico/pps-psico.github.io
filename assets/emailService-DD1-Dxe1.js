import{T as g,ct as b,cu as y}from"./index-ZXlslG1z.js";const x={seleccion:{subject:"Confirmaci√≥n de Asignaci√≥n PPS: {{nombre_pps}} üéì",body:`Hola {{nombre_alumno}},
Nos complace informarte que has sido seleccionado/a para realizar tu Pr√°ctica Profesional Supervisada en:
Instituci√≥n: {{nombre_pps}}
Horario/Comisi√≥n asignada: {{horario}}`},solicitud:{subject:"Actualizaci√≥n de tu Solicitud de PPS - UFLO",body:`Hola {{nombre_alumno}},
Hay novedades sobre tu solicitud de PPS en "{{institucion}}".
Nuevo Estado: {{estado_nuevo}}`},sac:{subject:"Acreditaci√≥n de Pr√°cticas en SAC ‚úÖ",body:`Hola {{nombre_alumno}},
Queremos avisarte que tus horas de la PPS "{{nombre_pps}}" fueron acreditadas correctamente y ya pod√©s visualizarlas en el sistema SAC.`}},$=()=>{const o=new Date,e=`${o.getFullYear()}-${o.getMonth()}`,r=localStorage.getItem(b);let l=0;r===e?l=parseInt(localStorage.getItem(y)||"0",10):localStorage.setItem(b,e),localStorage.setItem(y,String(l+1))},h=o=>o.replace(/^[\s\S]*?(Hola|Estimad[oa]|Buen d√≠a|Buenas tardes).*?(\n|$)/im,"").replace(/^\s*Espero que est√©s muy bien\.?\s*/im,"").trim(),S=o=>{const e=o.toLowerCase();return e.includes("puntualidad")||e.includes("asistencia")?{titleColor:"#1e40af",bg:"#eff6ff",border:"#bfdbfe"}:e.includes("√©tica")||e.includes("confidencialidad")?{titleColor:"#047857",bg:"#ecfdf5",border:"#a7f3d0"}:e.includes("rol")||e.includes("activo")?{titleColor:"#7e22ce",bg:"#faf5ff",border:"#e9d5ff"}:e.includes("documentaci√≥n")?{titleColor:"#be123c",bg:"#fff1f2",border:"#fecdd3"}:{titleColor:"#334155",bg:"#f8fafc",border:"#e2e8f0"}},w=o=>{const e=o.toLowerCase();return e.includes("instituci")?{icon:"üìç",color:"#dc2626"}:e.includes("horario")||e.includes("comisi")?{icon:"üìÖ",color:"#2563eb"}:{icon:"üëâ",color:"#475569"}},C=(o,e="Comunicaci√≥n Institucional")=>{const l=h(o).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").split(/\n/);let i="";const n="'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif";let d=!1;for(let f=0;f<l.length;f++){const t=l[f].trim();if(!t){i+='<div style="height: 12px;">&nbsp;</div>';continue}if(t.match(/^(Saludos|Atentamente|Cari√±os),?$/i)){d=!0,i+=`<div style="margin-top: 40px; border-top: 1px solid #e2e8f0; padding-top: 20px;"><p style="margin: 0; color: #64748b; font-size: 14px; font-family: ${n};">${t}</p>`;continue}if(d){const s=t.includes("Blas")?"700":"400",u=t.includes("Blas")?"16px":"13px",a=t.includes("Blas")?"#0f172a":"#64748b";i+=`<p style="margin: 4px 0; color: ${a}; font-weight: ${s}; font-size: ${u}; font-family: ${n};">${t}</p>`;continue}const p=t.match(/^\*\*(.*?)\*\*[:]?\s*(.*)/),c=t.match(/^([^:]+):[:]?\s*(.*)/);if(p){const s=p[1].trim(),u=p[2].trim(),a=S(s);i+=`<div style="margin-bottom: 12px; background-color: ${a.bg}; border: 1px solid ${a.border}; border-left: 4px solid ${a.titleColor}; border-radius: 6px; padding: 16px 20px;"><div style="color: ${a.titleColor}; font-family: ${n}; font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">${s}</div><div style="color: #334155; font-family: ${n}; font-size: 15px; line-height: 1.6;">${u}</div></div>`}else if(c&&(t.includes("Instituci√≥n")||t.includes("Horario")||t.includes("Estado")||t.includes("Comisi√≥n"))){const s=c[1].trim(),u=c[2].trim(),a=w(s);i+=`<div style="background-color: #ffffff; border: 1px solid #e2e8f0; border-left: 4px solid ${a.color}; border-radius: 8px; padding: 15px 20px; margin-bottom: 12px;"><table width="100%" border="0"><tr><td width="24" align="center" style="font-size: 18px;">${a.icon}</td><td style="font-family: ${n}; padding-left: 12px;"><div style="font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 600; letter-spacing: 0.5px;">${s}</div><div style="font-size: 15px; color: #0f172a; font-weight: 600;">${u}</div></td></tr></table></div>`}else{const s=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");i+=`<p style="margin: 0 0 16px 0; color: #475569; font-family: ${n}; font-size: 15px; line-height: 1.6;">${s}</p>`}}d&&(i+="</div>");const m=new Date().getFullYear();return`<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"></head><body style="margin: 0; padding: 0; background-color: #f1f5f9; font-family: ${n};"><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td align="center" style="padding: 40px 10px;"><table border="0" cellpadding="0" cellspacing="0" width="100%" style="max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 15px rgba(0,0,0,0.1);"><tr><td style="background: linear-gradient(135deg, #00B2A9 0%, #1e40af 100%); padding: 32px 40px;"><div style="color: #ffffff; font-family: ${n}; font-weight: 900; font-size: 28px;">UFLO</div><div style="color: #ffffff; font-family: ${n}; font-size: 11px; text-transform: uppercase; letter-spacing: 3px; opacity: 0.9;">Universidad</div></td></tr><tr><td style="padding: 40px;"><h1 style="margin: 0 0 24px 0; color: #0f172a; font-size: 24px; font-weight: 800;">${e}</h1><div style="font-size: 15px; color: #334155;">${i}</div></td></tr><tr><td style="background-color: #f8fafc; padding: 24px; text-align: center; border-top: 1px solid #e2e8f0;"><p style="margin: 0; font-size: 11px; color: #94a3b8; font-family: ${n};"><strong>Facultad de Psicolog√≠a y Ciencias Sociales</strong><br>Pr√°cticas Profesionales Supervisadas<br>&copy; ${m} Universidad de Flores</p></td></tr></table></td></tr></table></body></html>`},_=async(o,e)=>{try{const{data:r,error:l}=await g.from("email_templates").select("*").eq("id",o).maybeSingle();if(l)throw new Error("Error al consultar plantillas: "+l.message);if(r&&r.is_active===!1)return{success:!0,message:"Automaci√≥n desactivada"};if(!e.studentEmail)return{success:!1,message:"Falta email del alumno."};const i=(r==null?void 0:r.subject)||x[o].subject,n=(r==null?void 0:r.body)||x[o].body,d=i.replace(/{{nombre_pps}}/g,e.ppsName||"").replace(/{{institucion}}/g,e.institution||""),m=n.replace(/{{nombre_alumno}}/g,e.studentName).replace(/{{nombre_pps}}/g,e.ppsName||"").replace(/{{horario}}/g,e.schedule||"").replace(/{{institucion}}/g,e.institution||"").replace(/{{estado_nuevo}}/g,e.newState||"").replace(/{{notas}}/g,e.notes||""),f=`Hola, <span style="color: #2563eb;">${e.studentName.split(" ")[0]}</span>`,t=C(m,f),p=h(m),{error:c}=await g.functions.invoke("send-email",{body:{to:e.studentEmail,subject:d,text:p,html:t,name:e.studentName}});if(c)throw new Error(c.message||"Error en el servidor de correo");return $(),{success:!0}}catch(r){return console.error(`[EmailService] Error enviando correo (${o}):`,r),{success:!1,message:r.message||"Error de env√≠o"}}};export{h as a,C as g,_ as s};
